name: Triggering comments

on:
  issue_comment:
    types: [created]
  workflow_dispatch:
    inputs:
      comment-id:
        description: "Integer ID of a comment on a pull request."
        required: true
        type: string
      pr-url:
        description: "Full URL to the pull request the comment is from."
        required: true
        type: string

jobs:
  triggering-tests:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ github.token }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 5
          submodules: false

      - name: Trigger R valgrind tests
        #if: github.event.comment.body == '/gha run r-valgrind'
        run: |
          $GITHUB_WORKSPACE/.ci/trigger-dispatch-run.sh \
            "${{ inputs.pr-url }}" \
            "${{ inputs.comment-id }}" \
            "gha_run_r_valgrind"

      - name: Trigger update R configure
        if: github.event.comment.body == '/gha run r-configure'
        run: |
          $GITHUB_WORKSPACE/.ci/trigger-dispatch-run.sh \
            "${{ github.event.issue.pull_request.url }}" \
            "${{ github.event.comment.id }}" \
            "gha_run_r_configure"
