name: R generate configure

on:
  workflow_dispatch:
    inputs:
      pr-branch:
        type: string
        description: |
          Branch in microsoft/LightGBM to update.

permissions:
  actions: none
  checks: none
  contents: write
  deployments: none
  discussions: none
  id-token: write
  issues: none
  packages: none
  pages: none
  pull-requests: read
  repository-projects: none
  security-events: none
  statuses: none

jobs:
  r-configure:
    name: r-configure
    timeout-minutes: 60
    runs-on: ubuntu-latest
    container: "ubuntu:22.04"
    steps:
      - name: Install essential software before checkout
        run: |
          apt-get update
          apt-get install --no-install-recommends -y \
            ca-certificates \
            git
      - name: Trust git cloning LightGBM
        run: |
          git config --global --add safe.directory "${GITHUB_WORKSPACE}"
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 5
          submodules: false
          repository: microsoft/LightGBM
          ref: "refs/heads/${{ inputs.pr-branch }}"
          token: ${{ github.token }}
          persist-credentials: true
      - name: Update configure
        shell: bash
        run: ./R-package/recreate-configure.sh || exit 1
      - name: Push changes
        run: |
          # source for this user and email: https://github.com/orgs/community/discussions/160496
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add "./R-package/configure"
          git commit --allow-empty -m "Auto-update configure"
          git push
